{% extends 'base.html' %}
{% load bootstrap3 %}
{% load bootstrap_ui_tags %}
{% load render_table from django_tables2 %}

{% block title %}Submit metric{% endblock %}

{% block content %}

    <!-- bodywrap -->
    <div id="bodywrap">
        {% container %}

            <!-- activity icons -->
            {% row %}
                <div class='col-xs-12 button-wrapper'>
                    {% for activity in activities %}
                        <a href='?activity={{activity.id}}' type="button" class="btn btn-info">
                            <i class="fas {{activity.icon}} fa-2x" style="vertical-align: middle;"></i><span> {{activity.name}}</span>
                        </a>
                    {% endfor %}
                </div>
            {% endrow %}

            {% if success %}

                <!-- success message -->
                {% row %}
                    {% column xs="12" sm="5" lg="3" %}
                        <div class="alert alert-success" role="alert" style="margin-top:20px;">
                            Metric successfully submitted.
                        </div>
                    {% endcolumn %}
                {% endrow %}

            {% elif error %}

                <!-- serror message -->
                {% row %}
                    {% column xs="12" sm="5" lg="3" %}
                        <div class="alert alert-danger" role="alert">
                            An error occurred, please try again.
                        </div>
                    {% endcolumn %}
                {% endrow %}

            {% endif %}


            <!-- metric form -->
            {% if metric_form %}
                {% row %}
                    {% column %}
                        <hr>
                        <h2><code>{{selected_activity}}</code></h2>
                        <form method="post">
                            {% csrf_token %}
                            {% bootstrap_form metric_form %}
                            <button type="submit" class="btn btn-info pull-right">Submit</button>
                        </form>
                    {% endcolumn %}
                {% endrow %}
            {% endif %}

            <!-- list of user activities -->
            {% if activities_table %}
                {% row %}
                    {% column %}
                        {% render_table activities_table %}
                    {% endcolumn %}
                {% endrow %}
            {% endif %}

        {% endcontainer %}
    </div>
    <!-- end bodywrap -->

    <script>

        jQuery(function () {
            // we show/hide start to autopopulate with
            // user's current time - a little dirty ...
            if (jQuery('#id_time_stamp').length) {
                jQuery("#id_time_stamp").datetimepicker({
                    format: "YYYY-MM-DD H:mm:ss"
                }).data("DateTimePicker").show().hide();
            }

            jQuery("#id_end").datetimepicker({
                format: "YYYY-MM-DD H:mm:ss"
            });

            // set the end timestamp to the start timestamp if the default
            // end timestamp is before the end timestamp
            jQuery("#id_end").on("dp.show", function (e) {
                var start = jQuery('#id_time_stamp').data('DateTimePicker').date()
                var end = jQuery('#id_end').data('DateTimePicker').date()

                if (end < start) {
                    jQuery('#id_end').data('DateTimePicker').date(start);
                }
            });
        });


    </script>


{% endblock %}
